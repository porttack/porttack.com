<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Password Strength Checker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        #password { font-size: 16px; padding: 5px; width: 600px; }
        #result { margin-top: 10px; }
        .compromised-yes { color: red; }
        .compromised-no { color: darkgreen; }
    </style>
</head>
<body>
    <input type="text" id="password" placeholder="Enter password" oninput="checkPassword()">
    <div id="result"></div>

    <script>
        let lastCheckedPassword = '';
        let debounceTimer;

        async function checkPassword() {
            const password = document.getElementById('password').value;
            const result = zxcvbn(password);
            
            let score = Math.round((result.guesses_log10 / 16) * 100);
            score = Math.min(Math.max(score, 0), 100);
            
            document.getElementById('result').innerHTML = `
                Crack time: ${result.crack_times_display.offline_slow_hashing_1e4_per_second}<br>
                Compromised: Checking...<br>
                Score: ${score}/100
            `;

            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(async () => {
                if (password !== lastCheckedPassword) {
                    lastCheckedPassword = password;
                    const compromised = await checkCompromised(password);
                    if (compromised) {
                        score = 0;
                    }
                    const compromisedClass = compromised ? 'compromised-yes' : 'compromised-no';
                    document.getElementById('result').innerHTML = `
                        Crack time: ${result.crack_times_display.offline_slow_hashing_1e4_per_second}<br>
                        <span class="${compromisedClass}">Compromised: ${compromised ? 'Yes' : 'No'}</span><br>
                        Score: ${score}/100
                    `;
                }
            }, 300);
        }

        async function checkCompromised(password) {
            if (password.length === 0) return false;
            const sha1 = await sha1Hash(password);
            const prefix = sha1.substring(0, 5);
            const suffix = sha1.substring(5);
            const response = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
            const text = await response.text();
            return text.includes(suffix.toUpperCase());
        }

        async function sha1Hash(str) {
            const buffer = new TextEncoder().encode(str);
            const hash = await crypto.subtle.digest('SHA-1', buffer);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Initial check on page load
        checkPassword();
    </script>
</body>
</html>
