<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biased AI Responses - Gemini Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .responses {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .response {
            flex: 1;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .left-leaning {
            background-color: #e8f4f8;
            border-left: 5px solid #0077cc;
        }
        .right-leaning {
            background-color: #f8f1e8;
            border-left: 5px solid #cc7700;
        }
        .response h3 {
            margin-top: 0;
            color: #444;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            margin-bottom: 15px;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background-color: #0069d9;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .student-info {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .student-info input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .hidden {
            display: none;
        }
        .success-message {
            text-align: center;
            color: green;
            font-weight: bold;
            margin: 20px 0;
        }
        .error-message {
            text-align: center;
            color: red;
            font-weight: bold;
            margin: 20px 0;
        }
        .prompt-engineering {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        .prompt-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .toggle-prompts {
            color: #0077cc;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
            font-size: 14px;
        }
        .custom-prompt {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #666;
            margin: 10px 0;
        }
        .question-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .question-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .examples-dropdown {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
        }
        .info-box {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4a90e2;
            margin-bottom: 20px;
        }
        .checkbox-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
            margin-bottom: 15px;
            justify-content: center;
        }
        .checkbox-container label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 20px;
            border: 1px solid #ddd;
        }
        .checkbox-container input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        @media print {
            button, .no-print {
                display: none;
            }
            body, .section {
                background-color: white;
                box-shadow: none;
            }
            .response {
                border: 1px solid #ddd;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <h1>Analyzing Bias in AI Responses</h1>
    <p class="no-print">Complete the following activities to analyze how AI can show political bias in its responses.</p>
    
    <div class="container">
        <div class="section">
            <h2>Student Information</h2>
            <div class="student-info">
                <input type="text" id="student-name" placeholder="Your Name">
                <input type="text" id="student-id" placeholder="Student ID (optional)">
            </div>
        </div>

        <div class="section">
            <h2>Part 1: Identifying Bias in AI Responses</h2>
            
            <div class="question-input">
                <label for="custom-question">Question to analyze:</label>
                <input type="text" id="custom-question" value="Is the increasing use of robots and AI in the workplace good or bad for society?">
                <select id="example-questions" class="examples-dropdown">
                    <option value="">Example questions...</option>
                    <option value="Is the increasing use of robots and AI in the workplace good or bad for society?">Automation and jobs</option>
                    <option value="Should there be age restrictions on social media platforms?">Social media regulation</option>
                    <option value="How should technology be integrated into K-12 education?">Technology in education</option>
                    <option value="Is nuclear energy a good solution for climate change?">Nuclear energy</option>
                    <option value="Should genetic modification of foods be allowed?">GMO foods</option>
                    <option value="Should kids have smartphones in school?">Smartphones in school</option>
                    <option value="Is homework necessary for students?">Homework necessity</option>
                    <option value="Are video games good or bad for kids?">Video games</option>
                    <option value="Should schools have dress codes?">School dress codes</option>
                    <option value="Should animal testing be allowed?">Animal testing</option>
                </select>
            </div>
            
            <div class="prompt-engineering">
                <span class="toggle-prompts" id="toggle-prompts">Show Prompt Engineering Options</span>
                <div id="prompt-options" class="hidden">
                    <p>Customize how the AI is instructed to generate responses:</p>
                    
                    <div class="prompt-title">Response A Prompt:</div>
                    <textarea id="prompt-a" class="custom-prompt">Answer this question with a LEFT-WING perspective in about 3-6 sentences.
Use simple language that a 6th grader would understand:</textarea>
                    
                    <div class="prompt-title">Response B Prompt:</div>
                    <textarea id="prompt-b" class="custom-prompt">Answer this question with a RIGHT-WING perspective in about 3-6 sentences.
Use simple language that a 6th grader would understand:</textarea>
                </div>
            </div>
            
            <div class="checkbox-container">
                <label for="poem-mode">
                    <input type="checkbox" id="poem-mode">
                    Generate responses as poems
                </label>
            </div>
            
            <div class="info-box">
                <p><strong>How this works:</strong> When you click the "Generate Responses" button, the Gemini AI will create two responses to your question - one with a politically left-leaning bias and one with a right-leaning bias. This demonstrates how AI can generate politically slanted content based on how it's prompted.</p>
            </div>
            
            <button id="generate-both" class="generate-btn">Generate Responses</button>
            <div id="both-loading" class="loading hidden">Generating responses from Gemini AI...</div>
            <div id="error-message" class="error-message hidden"></div>
            
            <div class="responses">
                <div class="response left-leaning">
                    <h3>Response A (Left-Leaning)</h3>
                    <div id="response-a">
                        <p>Automation is taking jobs away from regular people! Big companies are using robots and AI just to make more money by firing workers. This is making rich tech companies richer while regular workers lose their jobs.</p>
                        <p>We need the government to step in and create laws that make companies pay special taxes when they use robots. This money should help workers who lost their jobs with free training programs and monthly checks to help them pay bills. Everyone deserves to benefit from new technology, not just wealthy company owners.</p>
                    </div>
                </div>
                <div class="response right-leaning">
                    <h3>Response B (Right-Leaning)</h3>
                    <div id="response-b">
                        <p>Robots and AI show how American innovation leads the world! Throughout history, new technology has always created better jobs than it replaced. Government rules would just slow down progress and make American companies fall behind other countries.</p>
                        <p>The free market will create new jobs as it always has. Companies should be free to use technology without extra taxes. It's up to each person to learn new skills for the future. The people who create these technologies worked hard and deserve their success - their companies create jobs that help everyone!</p>
                    </div>
                </div>
            </div>
            
            <h3>Analysis Questions:</h3>
            
            <p>1. What specific words or phrases in Response A indicate it might have a political bias? List at least 3 examples.</p>
            <textarea id="bias-words-a" placeholder="Type your answer here..."></textarea>
            
            <p>2. What specific words or phrases in Response B indicate it might have a political bias? List at least 3 examples.</p>
            <textarea id="bias-words-b" placeholder="Type your answer here..."></textarea>
            
            <p>3. What facts or information would help you evaluate whether these responses are accurate?</p>
            <textarea id="facts-needed" placeholder="Type your answer here..."></textarea>
        </div>
        
        <div class="section">
            <h2>Part 2: Creating a Balanced Response</h2>
            
            <p>Imagine you are programming an AI that needs to give a balanced, factual answer to the question you selected. Write a response that:</p>
            <ul>
                <li>Presents multiple perspectives without obvious bias</li>
                <li>Uses neutral language</li>
                <li>Acknowledges what we know and don't know</li>
            </ul>
            
            <textarea id="balanced-response" placeholder="Write your balanced AI response here..." rows="8"></textarea>
        </div>
        
        <div class="section">
            <h2>Part 3: Reflection</h2>
            
            <p>1. Why do you think AI sometimes gives biased responses?</p>
            <textarea id="why-bias" placeholder="Type your answer here..."></textarea>
            
            <p>2. As a computer science student, what responsibility do you think AI developers have to prevent bias?</p>
            <textarea id="developer-responsibility" placeholder="Type your answer here..."></textarea>
            
            <p>3. How might you use this knowledge about AI bias in your future use of technology?</p>
            <textarea id="future-use" placeholder="Type your answer here..."></textarea>
        </div>
        
        <button id="save-button">Save My Responses</button>
        <div id="success-message" class="success-message hidden">Your responses have been saved locally! You can print this page if you want a copy.</div>
    </div>

    <script>
        // IMPORTANT: Replace this with your actual Gemini API key
        const API_KEY = 'AIzaSyDq-_WZoGf_HKR93LHY8l9dGD4Jkou7LCA';
        
        // Toggle prompt engineering options
        document.getElementById('toggle-prompts').addEventListener('click', function() {
            const promptOptions = document.getElementById('prompt-options');
            const toggleText = document.getElementById('toggle-prompts');
            
            if (promptOptions.classList.contains('hidden')) {
                promptOptions.classList.remove('hidden');
                toggleText.textContent = 'Hide Prompt Engineering Options';
            } else {
                promptOptions.classList.add('hidden');
                toggleText.textContent = 'Show Prompt Engineering Options';
            }
        });
        
        // Example questions dropdown handler
        document.getElementById('example-questions').addEventListener('change', function() {
            if (this.value) {
                document.getElementById('custom-question').value = this.value;
            }
        });
        
        // Generate both responses simultaneously when the button is clicked
        document.getElementById('generate-both').addEventListener('click', generateBothResponses);
        
        async function generateBothResponses() {
            const question = document.getElementById('custom-question').value.trim();
            const poemMode = document.getElementById('poem-mode').checked;
            
            if (!question) {
                showError('Please enter a question to analyze.');
                return;
            }
            
            if (API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                showError('Please replace the API_KEY in the code with your actual Gemini API key.');
                return;
            }
            
            // Show loading indicator
            document.getElementById('both-loading').classList.remove('hidden');
            document.getElementById('error-message').classList.add('hidden');
            
            try {
                // Get custom prompts
                let promptA = document.getElementById('prompt-a').value.trim();
                let promptB = document.getElementById('prompt-b').value.trim();
                
                // Generate both responses in parallel
                const [leftResponse, rightResponse] = await Promise.all([
                    generateGeminiResponse(promptA, question, poemMode),
                    generateGeminiResponse(promptB, question, poemMode)
                ]);
                
                // Display the responses by replacing the original content
                document.getElementById('response-a').innerHTML = `<p>${leftResponse.replace(/\n/g, '</p><p>')}</p>`;
                document.getElementById('response-b').innerHTML = `<p>${rightResponse.replace(/\n/g, '</p><p>')}</p>`;
                
            } catch (error) {
                console.error('Error generating responses:', error);
                showError('Error generating responses. Please check the console for details.');
            } finally {
                // Hide loading indicator
                document.getElementById('both-loading').classList.add('hidden');
            }
        }
        
        // Function to generate a single response using Gemini API
        async function generateGeminiResponse(basePrompt, question, poemMode) {
            // Create appropriate prompt based on settings
            let prompt = "";
            
            if (poemMode) {
                // If poem mode is checked, modify the prompt
                const perspective = basePrompt.includes('LEFT-WING') ? 'LEFT-WING' : 
                                   basePrompt.includes('RIGHT-WING') ? 'RIGHT-WING' : '';
                
                prompt = `Write a short poem (4-6 lines) with a ${perspective} political perspective in simple language that a 6th grader would understand, answering this question: ${question}`;
            } else {
                // For regular mode, combine the base prompt and question
                prompt = `${basePrompt} ${question}`;
            }
            
            // Call the Gemini API
            const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + API_KEY, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                }),
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Gemini API error: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Unexpected response format from Gemini API');
            }
        }
        
        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        // When the save button is clicked
        document.getElementById('save-button').addEventListener('click', function() {
            // Get the response content
            const responseAContent = Array.from(document.getElementById('response-a').querySelectorAll('p'))
                .map(p => p.textContent)
                .join('\n');
                
            const responseBContent = Array.from(document.getElementById('response-b').querySelectorAll('p'))
                .map(p => p.textContent)
                .join('\n');
            
            // Collect all the data
            const studentData = {
                name: document.getElementById('student-name').value,
                id: document.getElementById('student-id').value,
                question: document.getElementById('custom-question').value,
                promptA: document.getElementById('prompt-a').value,
                promptB: document.getElementById('prompt-b').value,
                poemMode: document.getElementById('poem-mode').checked,
                biasWordsA: document.getElementById('bias-words-a').value,
                biasWordsB: document.getElementById('bias-words-b').value,
                factsNeeded: document.getElementById('facts-needed').value,
                balancedResponse: document.getElementById('balanced-response').value,
                whyBias: document.getElementById('why-bias').value,
                developerResponsibility: document.getElementById('developer-responsibility').value,
                futureUse: document.getElementById('future-use').value,
                leftResponse: responseAContent,
                rightResponse: responseBContent,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage
            const savedResponses = JSON.parse(localStorage.getItem('studentResponses') || '[]');
            savedResponses.push(studentData);
            localStorage.setItem('studentResponses', JSON.stringify(savedResponses));
            
            // Show success message
            document.getElementById('success-message').classList.remove('hidden');
            
            // Create teacher access link if it doesn't exist
            if (!document.getElementById('teacher-access')) {
                const teacherLink = document.createElement('a');
                teacherLink.id = 'teacher-access';
                teacherLink.href = 'javascript:void(0)';
                teacherLink.innerText = 'Teacher: Access All Responses';
                teacherLink.style.display = 'block';
                teacherLink.style.textAlign = 'center';
                teacherLink.style.marginTop = '20px';
                teacherLink.addEventListener('click', showAllResponses);
                document.body.appendChild(teacherLink);
            }
        });
        
        // Function to display all saved responses (for teacher use)
        function showAllResponses() {
            const savedResponses = JSON.parse(localStorage.getItem('studentResponses') || '[]');
            
            // Create an overlay to show the responses
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.right = '0';
            overlay.style.bottom = '0';
            overlay.style.backgroundColor = 'rgba(255,255,255,0.95)';
            overlay.style.padding = '20px';
            overlay.style.overflowY = 'auto';
            overlay.style.zIndex = '1000';
            
            // Add a close button
            const closeButton = document.createElement('button');
            closeButton.innerText = 'Close';
            closeButton.style.position = 'fixed';
            closeButton.style.top = '10px';
            closeButton.style.right = '10px';
            closeButton.addEventListener('click', () => document.body.removeChild(overlay));
            overlay.appendChild(closeButton);
            
            // Add export button
            const exportButton = document.createElement('button');
            exportButton.innerText = 'Export Data (CSV)';
            exportButton.style.position = 'fixed';
            exportButton.style.top = '10px';
            exportButton.style.right = '80px';
            exportButton.addEventListener('click', exportResponsesToCSV);
            overlay.appendChild(exportButton);
            
            // Add content
            const content = document.createElement('div');
            content.style.marginTop = '50px';
            
            if (savedResponses.length === 0) {
                content.innerHTML = '<h2>No responses saved yet</h2>';
            } else {
                content.innerHTML = `<h2>All Student Responses (${savedResponses.length})</h2>`;
                
                savedResponses.forEach((response, index) => {
                    const responseDiv = document.createElement('div');
                    responseDiv.className = 'section';
                    responseDiv.style.marginBottom = '20px';
                    responseDiv.innerHTML = `
                        <h3>Response #${index + 1}: ${response.name || 'Anonymous'}</h3>
                        <p><strong>Student ID:</strong> ${response.id || 'N/A'}</p>
                        <p><strong>Question Analyzed:</strong> ${response.question || 'Default question'}</p>
                        <p><strong>Prompt A:</strong> ${response.promptA || 'Default prompt'}</p>
                        <p><strong>Prompt B:</strong> ${response.promptB || 'Default prompt'}</p>
                        <p><strong>Poem Mode:</strong> ${response.poemMode ? 'Yes' : 'No'}</p>
                        <p><strong>Timestamp:</strong> ${new Date(response.timestamp).toLocaleString()}</p>
                        
                        <h4>Part 1: Identifying Bias</h4>
                        <p><strong>Bias words in Response A:</strong><br>${response.biasWordsA || 'No response'}</p>
                        <p><strong>Bias words in Response B:</strong><br>${response.biasWordsB || 'No response'}</p>
                        <p><strong>Facts needed:</strong><br>${response.factsNeeded || 'No response'}</p>
                        
                        <h4>Part 2: Balanced Response</h4>
                        <p>${response.balancedResponse || 'No response'}</p>
                        
                        <h4>Part 3: Reflection</h4>
                        <p><strong>Why bias exists:</strong><br>${response.whyBias || 'No response'}</p>
                        <p><strong>Developer responsibility:</strong><br>${response.developerResponsibility || 'No response'}</p>
                        <p><strong>Future use of knowledge:</strong><br>${response.futureUse || 'No response'}</p>
                        
                        <h4>Generated Responses</h4>
                        <p><strong>Left-leaning response:</strong><br>${response.leftResponse || 'Not generated'}</p>
                        <p><strong>Right-leaning response:</strong><br>${response.rightResponse || 'Not generated'}</p>
                        
                        <hr>
                    `;
                    content.appendChild(responseDiv);
                });
            }
            
            overlay.appendChild(content);
            document.body.appendChild(overlay);
        }
        
        // Function to export responses as CSV
        function exportResponsesToCSV() {
            const savedResponses = JSON.parse(localStorage.getItem('studentResponses') || '[]');
            
            if (savedResponses.length === 0) {
                alert('No responses to export');
                return;
            }
            
            // Create CSV content
            let csvContent = 'Name,ID,Question,PromptA,PromptB,PoemMode,Timestamp,"Bias Words A","Bias Words B","Facts Needed","Balanced Response","Why Bias","Developer Responsibility","Future Use","Left Response","Right Response"\n';
            
            savedResponses.forEach(response => {
                // Properly escape fields for CSV
                const escapeCsvField = (field) => {
                    return `"${(field || '').toString().replace(/"/g, '""')}"`;
                };
                
                const row = [
                    escapeCsvField(response.name),
                    escapeCsvField(response.id),
                    escapeCsvField(response.question),
                    escapeCsvField(response.promptA),
                    escapeCsvField(response.promptB),
                    escapeCsvField(response.poemMode ? 'Yes' : 'No'),
                    escapeCsvField(response.timestamp),
                    escapeCsvField(response.biasWordsA),
                    escapeCsvField(response.biasWordsB),
                    escapeCsvField(response.factsNeeded),
                    escapeCsvField(response.balancedResponse),
                    escapeCsvField(response.whyBias),
                    escapeCsvField(response.developerResponsibility),
                    escapeCsvField(response.futureUse),
                    escapeCsvField(response.leftResponse),
                    escapeCsvField(response.rightResponse),
                ].join(',');
                csvContent += row + '\n';
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset-utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'student_responses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
